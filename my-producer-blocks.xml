<div class="wiki-content maincontent"><h2>What can I do if my producer blocks sending a message?</h2>

<p>This relates to <link><page ri:content-title="Producer Flow Control"></page></link>.</p>

<h3>Active 4.x</h3>

<p>In ActiveMQ 4.x, all in transit messages are held in memory.  If you have a slow consumer, to avoid exausting the JVM memory and getting an out of memory error, ActiveMQ has a configurable limit of how many in transit messages it will hold.  Once it is reached,  producers will be slowed down / blocked.</p>

<p>A quick fix is just to bump up the setting in your <strong>usageManager</strong> in your <link><page ri:content-title="Xml Configuration"></page></link>. The default that ships with ActiveMQ is pretty low, only 20Mb of RAM, so try setting it to something large, say 512Mb.</p>

<p>An alternative approach is to set individual usageManager limits on different destinations and for producers versus consumers.</p>

<p>You might also want to use the <link><page ri:content-title="JMX"></page></link> support or <link><page ri:content-title="Web Console"></page></link> to look at what destinations are being used and what producers &amp; consumers you have to see whats going on.</p>

<h3>Active 5.x and Later</h3>

<p>As of 5.x of ActiveMQ there is support for <link><page ri:content-title="Message Cursors"></page></link> which by default move messages out of memory and onto disk.  So this problem will not be seen unless you fill up the max allocated disk space for message storage which typically is an order of magnitude larger.</p>

<h3>See Also</h3>

<ul><li><link><page ri:content-title="Producer Flow Control"></page></link></li><li><link><page ri:content-title="Message Cursors"></page></link></li></ul>
</div>

