<div class="wiki-content maincontent"><structured-macro ac:macro-id="e2358d29-392c-4d4e-ad46-a9bc2b143363" ac:name="note" ac:schema-version="1"><parameter ac:name="title">Note</parameter><rich-text-body><p> This article only applies to older versions of ActiveMQ, i.e. 5.3 and 5.4.0. From 5.4.2 onwards this issue has been adressed in the bugs <a shape="rect" href="https://issues.apache.org/jira/browse/AMQ-2511">AMQ-2511</a> and <a shape="rect" href="https://issues.apache.org/jira/browse/AMQ-2088">AMQ-2088</a>. </p></rich-text-body></structured-macro>
<p>You may experience problems sending large messages using networks across slow links.</p>

<p>The symptoms are usually that the network connection will be dropped and continuously re-established.</p>

<p>This problem arises because the ActiveMQ message broker continuously checks for activity on a socket, and whilst building a large message in the TCP socket buffer, the <link><page ri:content-title="ActiveMQ InactivityMonitor"></page><link-body>inactivity</link-body></link> monitor will time out - see <link><page ri:content-title="Configuring Wire Formats"></page></link> and the <link><page ri:content-title="TCP Transport Reference"></page></link>.<br clear="none">
The <link><page ri:content-title="ActiveMQ InactivityMonitor"></page><link-body>inactivity monitor</link-body></link> uses an activity flag that is only updated after a message is received (in case the connection is not idle).<br clear="none">
The monitor then clears the activity flag, waits the timeout amount and peeks at the activity flag. If it's still cleared, then we assume the connection was inactive. When the connection is NOT in use, a keep alive message is sent. But in case the connection is in use because of a larger message being sent/received, no keep alive will be sent and the activity flag will not be updated. That can lead to inactivity timeouts.<br clear="none">
Ideally the activity flag would get cleared every time a few bytes arrive from the network... but right now it is only cleared when an entire message is assembled.</p>

<p>You can either set the wireFormat.maxInactivityDuration property to a high value - or disable it (set it to zero) to work around this issue.</p>

<p>e.g. configure your network connection like this:</p>

<structured-macro ac:macro-id="fd790009-2e60-4165-b17f-51be3cb3ee05" ac:name="code" ac:schema-version="1"><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;beans xmlns="http://activemq.org/config/1.0"&gt;

  &lt;broker brokerName="receiver"&gt;
    &lt;transportConnectors&gt;
      &lt;transportConnector uri="tcp://localhost:62002"/&gt;
    &lt;/transportConnectors&gt;

    &lt;networkConnectors&gt;
      &lt;networkConnector uri="static:(tcp://somehost:62001?wireFormat.maxInactivityDuration=0)"/&gt;
    &lt;/networkConnectors&gt;

    &lt;persistenceAdapter&gt;
      &lt;memoryPersistenceAdapter/&gt;
    &lt;/persistenceAdapter&gt;
  &lt;/broker&gt;

&lt;/beans&gt;
</plain-text-body></structured-macro>

<h3>See also</h3>
<p><link><page ri:content-title="ActiveMQ InactivityMonitor"></page></link></p></div>

