<div class="wiki-content maincontent"><h3 id="ExclusiveConsumer-Background">Background</h3>

<p>We maintain the order of messages in queues and dispatch them to consumers in order. However if you have multiple JMS Sessions and MessageConsumer instances consuming from the same queue (whether in the same JVM or not), you will loose the guarantee of processing the messages in order; since the messages with be processed concurrently in different threads.</p>

<p>Sometimes its important to guarantee the order in which messages are processed. e.g. you don't want to process the update to an order until an insert has been done; or to go backwards in time, overwriting an newer update of an order with an older one etc.</p>

<p>So what folks have to do in J2EE clusters is often to <em>pin</em> one particular JVM in the cluster to have <em>one</em> consumer on the queue to avoid loosing ordering. The problem with this is that if the particular pinned JVM goes down, no one is processing the queue any more, which can be problem.</p>

<h3 id="ExclusiveConsumer-ExclusiveConsumer">Exclusive Consumer</h3>

<p>We have a new feature in 4.x called Exclusive Consumer or Exclusive Queues which avoids the end user having to <em>pin</em> anything. The broker will pick a single MessageConsumer to get all the messages for a queue to ensure ordering. If that consumer fails, the broker will auto failover and choose another consumer.</p>

<p>So the effect is a heterogeneous J2EE cluster where each JVM has the same setup and configuration; the broker is choosing one consumer to be the <em>master</em> and send all the messages to it in order until it dies; then you get immediate failover to another consumer.</p>

<p>For those who've struggled with pinning JMS consumers in J2EE clusters you'll immediately realize how useful this is to making clustered, high available distributed services.</p>

<h3 id="ExclusiveConsumer-Example">Example</h3>

<p>An Exclusive Consumer is created using <a shape="rect" href="destination-options.html">Destination Options</a> as follows:</p>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
queue = new ActiveMQQueue("TEST.QUEUE?consumer.exclusive=true");
consumer = session.createConsumer(queue);
</pre>
</div></div></div>

