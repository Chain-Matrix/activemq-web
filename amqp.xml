<div class="wiki-content maincontent"><p>ActiveMQ supports the <a shape="rect" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=amqp">AMQP 1.0</a> protocol which is an OASIS standard.</p><structured-macro ac:macro-id="f7ac2108-fc07-4918-880f-69a75f359248" ac:name="info" ac:schema-version="1"><parameter ac:name="title">Availability</parameter><rich-text-body><p>Available from ActiveMQ version <link><page ri:content-title="ActiveMQ 5.8.0 Release"></page><plain-text-link-body>5.8</plain-text-link-body></link> onward.</p></rich-text-body></structured-macro><h3>Enabling the ActiveMQ Broker for AMQP</h3><p>To enable AMQP protocol support on the broker add the following transport connector configuration referencing the&#160;<strong><code>amqp</code></strong> scheme in its URI:</p><structured-macro ac:macro-id="ef3fdf06-2ed8-4cff-8c83-850e28ce1eca" ac:name="code" ac:schema-version="1"><plain-text-body>&lt;transportConnectors&gt;
   &lt;transportConnector name="amqp" uri="amqp://0.0.0.0:5672"/&gt;
&lt;/transportConnectors&gt;
</plain-text-body></structured-macro><p>It is enabled in the default ActiveMQ server configuration. For more help see <link><page ri:content-title="Run Broker"></page></link>.</p><h3>Security</h3><p>The AMQP implementation fully supports an <link><page ri:content-title="Security"></page><plain-text-link-body>ActiveMQ security</plain-text-link-body></link> mechanism. This allows the broker to accept plain SASL authentication. Authorization policies are applied to a destination when it's accessed (read/write).</p><structured-macro ac:macro-id="23a9920d-bead-4048-9614-45d166255570" ac:name="tip" ac:schema-version="1"><parameter ac:name="title">SSL</parameter><rich-text-body><p>For additional security AMQP can be configured to run over SSL as described in the following section.</p></rich-text-body></structured-macro><h3>Enabling AMQP over NIO</h3><p>For better scalability (and performance) the AMQP protocol should be configured to use NIO, rather than the default of TCP. To use NIO use the transport scheme <strong><code>amqp+nio</code></strong> instead of <strong><code>amqp</code></strong>.</p><p>Example:</p><structured-macro ac:macro-id="0ab55b1f-ee01-434f-82d9-e009f1c68625" ac:name="code" ac:schema-version="1"><parameter ac:name="">xml</parameter><plain-text-body>&lt;transportConnector name="amqp+nio" uri="amqp+nio://localhost:5672"/&gt;
</plain-text-body></structured-macro><p>This transport uses the <a shape="rect" href="http://activemq.apache.org/configuring-transports.html#ConfiguringTransports-TheNIOTransport">NIO transport</a> underneath and will generally use much less threads than the standard connector. This connector can help if you want to use <a shape="rect" href="http://activemq.apache.org/how-do-i-configure-10s-of-1000s-of-queues-in-a-single-broker-.html">large number of queues</a></p><h3>Enabling AMQP over SSL</h3><p>It's easy to configure ActiveMQ to use AMQP over a SSL connection. To use SSL use the transport scheme <strong><code>amqp+ssl</code></strong> instead of <strong><code>amqp</code></strong>.</p><p>Example:</p><structured-macro ac:macro-id="1b2eaa95-2237-4062-85d0-8f9e9566e4ce" ac:name="code" ac:schema-version="1"><parameter ac:name="">xml</parameter><plain-text-body>&lt;transportConnector name="amqp+ssl" uri="amqp+ssl://localhost:5671"/&gt;
</plain-text-body></structured-macro><p>For more details on using SSL with ActiveMQ, see the following article (<a shape="rect" href="http://activemq.apache.org/how-do-i-use-ssl.html">How do I use SSL</a>).</p><h3>Working with Destinations with AMQP</h3><p>You should prefix destination address with&#160;<strong><code>queue://</code></strong> to use queue based destinations or&#160;<strong><code>topic://</code></strong> to use topic based destinations. The destination type defaults to queue when the destination prefix is omitted.</p><h3>Prefetch Size and Credit</h3><p>When AMQP receiver connects to the broker it's mapped to the JMS consumer. This JMS consumer has to have appropriate <link><page ri:content-title="What is the Prefetch Limit For?"></page><plain-text-link-body>prefetch size</plain-text-link-body></link> set.&#160;<span style="line-height: 1.4285715;">The broker will honor the credit set by the client or use the default value of&#160;<strong><code>1000</code></strong> if client doesn't set it.</span></p><p>Example: tuning the default <strong><code>prefetch</code></strong> size:</p><structured-macro ac:macro-id="9a30b86c-fde9-40bc-be6b-86af0f621a5b" ac:name="code" ac:schema-version="1"><parameter ac:name="language">xml</parameter><plain-text-body>&lt;transportConnector name="amqp" uri="amqp://0.0.0.0:5672?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&amp;amp;transport.prefetch=10"/&gt;</plain-text-body></structured-macro><p class="p1">In this case, client preference will be ignored and the configured value will be used.</p><p class="p1">You can also tune broker-side&#160;<strong><code>amqp</code></strong> receiver link that handles incoming messages. It will use credit of&#160;<strong><code>1000</code></strong> messages by default, but you can override this by using&#160;<span><strong><code>producerCredit</code></strong> property, like&#160;</span></p><structured-macro ac:macro-id="e342bae5-f001-43ea-aac3-191f7f4d8b81" ac:name="code" ac:schema-version="1"><parameter ac:name="language">xml</parameter><plain-text-body>&lt;transportConnector name="amqp" uri="amqp://0.0.0.0:5672?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&amp;amp;transport.producerCredit=10000"/&gt;</plain-text-body></structured-macro><h3>Mapping to JMS</h3><p>There are three basic conversion strategies that can be used with AMQP and inter-operating with the JMS API.</p><table><tbody><tr><th colspan="1" rowspan="1"><p>Strategy</p></th><th colspan="1" rowspan="1"><p>Description</p></th></tr><tr><td colspan="1" rowspan="1"><p><code>native</code></p></td><td colspan="1" rowspan="1"><p>(<strong>Default</strong>) Wraps the bytes of the AMQP message into a JMS&#160;<strong><code>BytesMessage</code></strong> and maps the headers of the AMQP message to headers on the JMS message.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>raw</code></p></td><td colspan="1" rowspan="1"><p>Wraps the bytes of the AMQP message into a JMS <strong><code>BytesMessage</code></strong>.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>jms</code></p></td><td colspan="1" rowspan="1"><p>Maps headers of the AMQP message to JMS message headers and the body of the AMQP message to the JMS body.</p></td></tr></tbody></table><p>Set the <strong>transformer</strong> transport option on the&#160;<strong><code>transportConnector</code></strong> to the desired mapping strategy. For example, to inter-operate with JMS at the payload level, set the <strong><code>transformer</code></strong> option to <strong><code>jms</code></strong>:</p><structured-macro ac:macro-id="92bbef4f-f76c-4b71-b56c-ee2f2afda28d" ac:name="code" ac:schema-version="1"><parameter ac:name="">xml</parameter><plain-text-body>&lt;transportConnector name="amqp" uri="amqp://localhost:5672?transport.transformer=jms"/&gt;
</plain-text-body></structured-macro><h4>How AMQP Message Headers are Mapped to JMS Headers</h4><p>The following headers are mapped regardless of the transformer used:</p><table><tbody><tr><th colspan="1" rowspan="1"><p>AMQP Message</p></th><th colspan="1" rowspan="1"><p>JMS Message</p></th><th colspan="1" rowspan="1"><p>Notes</p></th></tr><tr><td colspan="1" rowspan="1"><p>&#160;</p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_NATIVE</code></p></td><td colspan="1" rowspan="1"><p>Will be set to&#160;<strong><code>true</code></strong> if the transformer is&#160;<strong><code>native</code></strong> or <strong><code>raw</code></strong>,&#160;<strong><code>false</code></strong> otherwise.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>message-format</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_MESSAGE_FORMAT</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr></tbody></table><p>The following header mappings apply when the transformer is either <strong><code>native</code></strong> or <strong><code>jms</code></strong>:</p><table><tbody><tr><th colspan="1" rowspan="1"><p>AMQP Message</p></th><th colspan="1" rowspan="1"><p>JMS Message</p></th><th colspan="1" rowspan="1"><p>Notes</p></th></tr><tr><td colspan="1" rowspan="1"><p><code>application-properties.JMSXGroupID</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXGroupID</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>application-properties.JMSXGroupSequence</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXGroupSequence</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>application-properties.JMSXUserID</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXUserID</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>application-properties.<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p><u><strong><code>name</code></strong></u></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>delivery-annotations.<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_DA_<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>footer.<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_FT_<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>header.deliveryCount</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXDeliveryCount</code></p></td><td colspan="1" rowspan="1">&#160;</td></tr><tr><td colspan="1" rowspan="1"><p><code>header.durable</code></p></td><td colspan="1" rowspan="1"><p><code>JMSDeliveryMode</code></p></td><td colspan="1" rowspan="1"><p><strong><code>javax.jms.Message.DEFAULT_DELIVERY_MODE</code></strong> if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>header.first-acquirer</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_FirstAcquirer</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>header.priority</code></p></td><td colspan="1" rowspan="1"><p><code>JMSPriority</code></p></td><td colspan="1" rowspan="1"><p><strong><code>javax.jms.Message.DEFAULT_PRIORITY</code></strong> if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>header.ttl</code></p></td><td colspan="1" rowspan="1"><p><code>JMSExpiration</code></p></td><td colspan="1" rowspan="1"><p><strong><code>javax.jms.Message.DEFAULT_TIME_TO_LIVE</code></strong> if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>message-annotations.<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_MA_<u><strong>name</strong></u></code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>message-annotations.x-opt-jms-type</code></p></td><td colspan="1" rowspan="1"><p><code>JMSType</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>message-annotations.x-opt-reply-type</code></p></td><td colspan="1" rowspan="1"><p>Type of the&#160;<code>JMSReplyTo</code></p></td><td colspan="1" rowspan="1"><p>Comma separated list of <strong><code>queue</code></strong>, <strong><code>topic</code></strong>, or <strong><code>temporary</code></strong>. Defaults to&#160;<strong><code>queue</code></strong> if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>message-annotations.x-opt-to-type</code></p></td><td colspan="1" rowspan="1"><p>Type of the&#160;<code>JMSDestination</code></p></td><td colspan="1" rowspan="1"><p>Comma separated list of <strong><code>queue</code></strong>, <strong><code>topic</code></strong>, or <strong><code>temporary</code></strong>. Defaults to&#160;<strong><code>queue</code></strong> if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.content-encoding</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_ContentEncoding</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.content-type</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_ContentType</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.correlation-id</code></p></td><td colspan="1" rowspan="1"><p><code>JMSCorrelationID</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.creation-time</code></p></td><td colspan="1" rowspan="1"><p><code>JMSTimestamp</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.group-sequence</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXGroupSequence</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.message-id</code></p></td><td colspan="1" rowspan="1"><p><code>JMSMessageID</code></p></td><td colspan="1" rowspan="1"><p>Auto generated if not set.</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.reply-to</code></p></td><td colspan="1" rowspan="1"><p><code>JMSReplyTo</code></p></td><td colspan="1" rowspan="1"><p>The name of the&#160;<strong><code>JMSReplyTo</code></strong></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.reply-to-group-id</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_ReplyToGroupID</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.subject</code></p></td><td colspan="1" rowspan="1"><p><code>JMS_AMQP_Subject</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.to</code></p></td><td colspan="1" rowspan="1"><p><code>JMSDestination</code></p></td><td colspan="1" rowspan="1"><p>The name of the&#160;<strong><code>JMSDestination</code></strong></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>properties.user-id</code></p></td><td colspan="1" rowspan="1"><p><code>JMSXUserID</code></p></td><td colspan="1" rowspan="1"><p><strong><code>properties.user-id</code></strong> is decoded as a UTF-8 String.</p></td></tr></tbody></table><p>&#160;</p><p>AMQP property value types are converted as follows:</p><table><tbody><tr><th colspan="1" rowspan="1"><p>AMQP Type</p></th><th colspan="1" rowspan="1"><p>Java Type</p></th><th colspan="1" rowspan="1"><p>Notes</p></th></tr><tr><td colspan="1" rowspan="1"><p><code>binary</code></p></td><td colspan="1" rowspan="1"><p><code>String</code></p></td><td colspan="1" rowspan="1"><p>Hex encoding of the binary value</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>bool</code></p></td><td colspan="1" rowspan="1"><p><code>Boolean</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>byte</code></p></td><td colspan="1" rowspan="1"><p><code>Byte</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>double</code></p></td><td colspan="1" rowspan="1"><p><code>Double</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>float</code></p></td><td colspan="1" rowspan="1"><p><code>Float</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>int</code></p></td><td colspan="1" rowspan="1"><p><code>Integer</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>long</code></p></td><td colspan="1" rowspan="1"><p><code>Long</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>short</code></p></td><td colspan="1" rowspan="1"><p><code>Short</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>symbol</code></p></td><td colspan="1" rowspan="1"><p><code>String</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>ubyte</code></p></td><td colspan="1" rowspan="1"><p><code>Byte</code> or&#160;<code>Short</code></p></td><td colspan="1" rowspan="1"><p><strong><code>Short</code></strong> is used if: <strong><code>value &gt;</code></strong> <strong><code>Byte.MAX_VALUE</code></strong></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>uint</code></p></td><td colspan="1" rowspan="1"><p><code>Integer</code> or&#160;<code>Long</code></p></td><td colspan="1" rowspan="1"><p><strong><code>Long</code></strong> is used if: <strong><code>value &gt;</code></strong> <strong><code>Integer.MAX_VALUE</code></strong></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>ulong</code></p></td><td colspan="1" rowspan="1"><p><code>Long</code></p></td><td colspan="1" rowspan="1"><p>&#160;</p></td></tr><tr><td colspan="1" rowspan="1"><p><code>ushort</code></p></td><td colspan="1" rowspan="1"><p><code>Short</code> or&#160;<code>Integer</code></p></td><td colspan="1" rowspan="1"><p><strong><code>Integer</code></strong> is used if:&#160;<strong><code>value &gt;</code></strong> <strong><code>Short.MAX_VALUE</code></strong></p></td></tr></tbody></table><structured-macro ac:macro-id="1bc9267d-a4b2-4453-931f-845db9ecf314" ac:name="htmlcomment" ac:schema-version="1"><parameter ac:name="atlassian-macro-output-type">BLOCK</parameter><rich-text-body><table><tbody><tr><td colspan="1" rowspan="1"><p>char</p></td><td colspan="1" rowspan="1"><p>String</p></td></tr><tr><td colspan="1" rowspan="1"><p>timestamp</p></td><td colspan="1" rowspan="1"><p>Long</p></td></tr></tbody></table></rich-text-body></structured-macro><h4>How a AMQP Messages Body is Mapped to a JMS Message</h4><p>If the transformer is set to <strong><code>jms</code></strong> then the JMS message type will depend on the body type of the AMQP message.</p><table><tbody><tr><th colspan="1" rowspan="1"><p>Body Type</p></th><th colspan="1" rowspan="1"><p>JMS Message Type</p></th></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpSequence</code></p></td><td colspan="1" rowspan="1"><p><code>StreamMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpValue</code></p></td><td colspan="1" rowspan="1"><p><code>ObjectMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpValue</code> holding a&#160;<code>null</code></p></td><td colspan="1" rowspan="1"><p><code>Message</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpValue</code> holding a&#160;<code>String</code></p></td><td colspan="1" rowspan="1"><p><code>TextMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpValue</code> holding a&#160;<code>binary</code></p></td><td colspan="1" rowspan="1"><p><code>BytesMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>AmqpValue</code> holding a&#160;<code>list</code></p></td><td colspan="1" rowspan="1"><p><code>StreamMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>Data</code></p></td><td colspan="1" rowspan="1"><p><code>BytesMessage</code></p></td></tr><tr><td colspan="1" rowspan="1"><p><code>null</code></p></td><td colspan="1" rowspan="1"><p><code>Message</code></p></td></tr></tbody></table><h3>AMQP 1.0 client library</h3><p>You can use <a shape="rect" href="http://qpid.apache.org/proton/">Apache Qpid Proton</a>.</p></div>

